{
  "if": {
    "anyOf": [
      {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.MachineLearningServices/workspaces/onlineEndpoints/deployments"
          },
          {
            "field": "Microsoft.MachineLearningServices/workspaces/onlineEndpoints/deployments/model",
            "notIn": "[parameters('allowedModelIds')]"
          }
        ]
      },
      {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.MachineLearningServices/workspaces/batchEndpoints/deployments"
          },
          {
            "field": "Microsoft.MachineLearningServices/workspaces/batchEndpoints/deployments/model",
            "notIn": "[parameters('allowedModelIds')]"
          }
        ]
      },
      {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints"
          },
          {
            "anyOf": [
              {
                "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/modelSettings.modelId",
                "in": "[parameters('deniedModelIds')]"
              },
              {
                "allOf": [
                  {
                    "not": {
                      "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/modelSettings.modelId",
                      "in": "[parameters('allowedModelIds')]"
                    }
                  },
                  {
                    "anyOf": [
                      {
                        "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer",
                        "exists": "false"
                      },
                      {
                        "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer",
                        "equals": "null"
                      },
                      {
                        "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                        "exists": "false"
                      },
                      {
                        "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                        "equals": ""
                      },
                      {
                        "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                        "equals": "null"
                      },
                      {
                        "allOf": [
                          {
                            "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                            "exists": "true"
                          },
                          {
                            "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                            "notEquals": ""
                          },
                          {
                            "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                            "notEquals": "null"
                          },
                          {
                            "not": {
                              "field": "Microsoft.MachineLearningServices/workspaces/serverlessEndpoints/offer.publisher",
                              "in": "[parameters('allowedPublishers')]"
                            }
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  },
  "then": {
    "effect": "[parameters('effect')]"
  }
}
